<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin | VIKA HQ</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ea580c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background-color: #f1f5f9; }
        .sidebar-link { transition: all 0.2s; border-radius: 12px; font-weight: 700; font-size: 0.9rem; color: #64748b; display: flex; align-items: center; gap: 12px; padding: 14px 16px; cursor: pointer; }
        .sidebar-link:hover { background: #fff7ed; color: #ea580c; }
        .sidebar-link.active { background: #ea580c; color: white; box-shadow: 0 10px 15px -3px rgba(234, 88, 12, 0.3); }
        .slide-up { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        @media (max-width: 768px) { .sidebar { display: none; } .mobile-nav { display: flex; } .main-content { margin-left: 0; padding-bottom: 90px; } }
        @media (min-width: 769px) { .sidebar { display: block; } .mobile-nav { display: none; } .main-content { margin-left: 280px; } }
    </style>
</head>
<body class="text-slate-800 antialiased bg-slate-50 select-none">

    <div id="installBanner" class="fixed bottom-24 left-4 right-4 bg-slate-900 text-white p-4 rounded-2xl shadow-2xl z-[9999] hidden slide-up flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="bg-orange-600 w-10 h-10 rounded-xl flex items-center justify-center font-black italic shadow-lg">A</div>
            <div><h4 class="font-bold text-sm">Install Admin App</h4><p class="text-[10px] text-gray-400">Manage business easily</p></div>
        </div>
        <button id="installBtn" class="bg-white text-slate-900 px-4 py-2 rounded-xl text-xs font-bold shadow-lg">INSTALL</button>
        <button onclick="document.getElementById('installBanner').classList.add('hidden')" class="absolute -top-2 -right-2 bg-red-500 text-white w-6 h-6 rounded-full text-xs flex items-center justify-center shadow-md"><i class="fas fa-times"></i></button>
    </div>

    <div id="login" class="fixed inset-0 bg-slate-900 z-[100] flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-8 text-center shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-orange-500 to-red-500"></div>
            <div class="w-20 h-20 bg-orange-50 rounded-full flex items-center justify-center mx-auto mb-6 text-orange-600 text-3xl font-black shadow-inner border border-orange-100">V</div>
            <h2 class="text-4xl font-black mb-2 text-slate-800 italic tracking-tighter">VIKA HQ</h2>
            <p class="text-xs text-slate-400 mb-8 font-bold uppercase tracking-widest">Master Control Panel</p>
            <input type="password" id="pin" placeholder="Enter PIN" class="w-full bg-slate-50 border-2 border-slate-200 p-4 rounded-xl text-center font-black text-xl outline-none mb-6 focus:border-orange-500 transition shadow-inner">
            <button onclick="auth()" id="loginBtn" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold shadow-xl hover:scale-[1.02] active:scale-95 transition">UNLOCK SYSTEM</button>
        </div>
    </div>

    <div id="sidebarPanel" class="sidebar fixed top-0 left-0 h-full w-[280px] bg-white border-r border-slate-200 z-40 hidden p-6 shadow-sm">
        <div class="flex items-center gap-3 mb-10 px-2">
            <img id="sidebarLogo" src="https://cdn-icons-png.flaticon.com/512/3075/3075977.png" class="w-12 h-12 rounded-xl object-cover shadow-lg border border-slate-100 bg-orange-50 p-1">
            <div>
                <h1 class="text-2xl font-black italic tracking-tighter leading-none" id="sidebarAppName">VIKA</h1>
                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Super Admin</p>
            </div>
        </div>
        <nav class="space-y-2">
            <button onclick="view('dash')" id="nav-dash" class="sidebar-link active w-full"><i class="fas fa-chart-pie w-6 text-lg"></i> Overview</button>
            <button onclick="view('req')" id="nav-req" class="sidebar-link w-full justify-between">
                <div class="flex items-center gap-3"><i class="fas fa-user-check w-6 text-lg"></i> Approvals</div>
                <span id="reqBadge" class="bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full hidden shadow-sm">0</span>
            </button>
            <button onclick="view('shops')" id="nav-shops" class="sidebar-link w-full"><i class="fas fa-store w-6 text-lg"></i> Manage Shops</button>
            <button onclick="view('menu')" id="nav-menu" class="sidebar-link w-full"><i class="fas fa-utensils w-6 text-lg"></i> Food & Items</button>
            <button onclick="view('riders')" id="nav-riders" class="sidebar-link w-full"><i class="fas fa-motorcycle w-6 text-lg"></i> Rider Fleet</button>
            <button onclick="view('ord')" id="nav-ord" class="sidebar-link w-full"><i class="fas fa-shopping-bag w-6 text-lg"></i> Orders</button>
            <button onclick="view('offers')" id="nav-offers" class="sidebar-link w-full"><i class="fas fa-percent w-6 text-lg"></i> Offers</button>
            <button onclick="view('set')" id="nav-set" class="sidebar-link w-full"><i class="fas fa-cog w-6 text-lg"></i> Settings</button>
        </nav>
        <div class="absolute bottom-6 left-6 right-6">
            <button onclick="location.reload()" class="w-full bg-slate-50 text-slate-500 py-3.5 rounded-xl font-bold text-xs hover:bg-red-50 hover:text-red-500 transition flex items-center justify-center gap-2 border border-slate-200"><i class="fas fa-power-off"></i> LOGOUT</button>
        </div>
    </div>

    <div id="mainPanel" class="main-content min-h-screen hidden p-4 md:p-8 pt-6">
        
        <div id="view-dash" class="slide-up">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-black text-slate-800 tracking-tight">Dashboard Overview</h2>
                <button onclick="window.exportCSV()" class="bg-green-600 text-white px-4 py-2 rounded-xl text-[10px] font-bold shadow-lg flex items-center gap-2 hover:scale-105 transition"><i class="fas fa-file-csv text-lg"></i> EXPORT DATA</button>
            </div>
            
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm relative overflow-hidden group">
                    <p class="text-[10px] text-slate-400 font-bold uppercase relative z-10 tracking-widest">Total Revenue</p>
                    <h3 class="text-4xl font-black text-slate-800 mt-2 relative z-10" id="dashRev">₹0</h3>
                </div>
                <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm relative overflow-hidden group">
                    <p class="text-[10px] text-slate-400 font-bold uppercase relative z-10 tracking-widest">Total Orders</p>
                    <h3 class="text-4xl font-black text-orange-600 mt-2 relative z-10" id="dashOrd">0</h3>
                </div>
                <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm group">
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Cash Pending (Riders)</p>
                    <h3 class="text-4xl font-black text-red-500 mt-2 group-hover:text-red-600 transition" id="dashPendingCash">₹0</h3>
                </div>
                <div class="bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm group">
                    <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Active Riders</p>
                    <h3 class="text-4xl font-black text-green-600 mt-2 group-hover:text-green-700 transition" id="dashRiders">0</h3>
                </div>
            </div>
            
            <h3 class="font-black text-xl mb-4 flex items-center gap-2 text-slate-700"><i class="fas fa-history text-slate-400"></i> Recent Activity</h3>
            <div id="recentOrders" class="space-y-3 bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm min-h-[200px]"></div>
        </div>

        <div id="view-req" class="hidden slide-up">
            <h2 class="text-3xl font-black text-slate-800 mb-6">Pending Approvals</h2>
            
            <div class="mb-8">
                <h3 class="font-black text-xl mb-4 text-orange-600 border-b pb-2 flex justify-between items-center">
                    Rider Applications <span class="bg-orange-100 text-orange-600 px-2 rounded-lg text-xs" id="riderReqCount">0</span>
                </h3>
                <div id="riderReqList" class="grid md:grid-cols-2 gap-4"></div>
            </div>

            <div>
                <h3 class="font-black text-xl mb-4 text-blue-600 border-b pb-2 flex justify-between items-center">
                    Shop Applications <span class="bg-blue-100 text-blue-600 px-2 rounded-lg text-xs" id="shopReqCount">0</span>
                </h3>
                <div id="shopReqList" class="grid md:grid-cols-2 gap-4"></div>
            </div>
        </div>

        <div id="view-shops" class="hidden slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-black text-slate-800 tracking-tight">Shop Accounts</h2>
                <button onclick="document.getElementById('addShopModal').classList.remove('hidden')" class="bg-blue-600 text-white px-5 py-3 rounded-xl text-xs font-bold shadow-lg flex items-center gap-2 hover:scale-105 transition"><i class="fas fa-plus"></i> Create New Shop</button>
            </div>
            
            <div class="mb-6">
                <input id="shopSearch" placeholder="Search Shops by Name..." class="bg-white border-2 border-slate-200 p-3 rounded-xl text-sm font-bold outline-none w-full md:w-1/2 focus:border-blue-500 transition" oninput="renderShops()">
            </div>
            
            <div id="shopList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>

        <div id="view-menu" class="hidden slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-black text-slate-800 tracking-tight">Global Menu</h2>
                <button onclick="document.getElementById('prodModal').classList.remove('hidden'); document.getElementById('prodMode').value='add';" class="bg-orange-600 text-white px-5 py-3 rounded-xl text-xs font-bold shadow-lg flex items-center gap-2 hover:scale-105 transition"><i class="fas fa-plus"></i> Add Item</button>
            </div>
            <div id="allProdList" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
        </div>

        <div id="view-riders" class="hidden slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-black text-slate-800">Active Riders</h2>
                <div class="flex gap-2">
                    <input id="riderSearch" placeholder="Search Riders..." class="bg-white border-2 border-slate-200 p-3 rounded-xl text-xs font-bold outline-none focus:border-orange-500 transition" oninput="renderRiders()">
                    <button onclick="document.getElementById('addRiderModal').classList.remove('hidden')" class="bg-green-600 text-white px-5 py-3 rounded-xl text-xs font-bold shadow-lg flex items-center gap-2 hover:scale-105 transition"><i class="fas fa-user-plus"></i> Add Rider</button>
                </div>
            </div>
            <div id="ridList" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </div>

        <div id="view-ord" class="hidden slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-black text-slate-800">Order Management</h2>
                <input id="ordSearch" placeholder="Search Order ID..." class="bg-white border-2 border-slate-200 p-3 rounded-xl text-xs font-bold outline-none w-64" oninput="renderOrd()">
            </div>
            <div id="ordList" class="space-y-4 pb-20"></div>
        </div>

        <div id="view-offers" class="hidden slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-black text-slate-800">Offers & Deals</h2>
                <button onclick="document.getElementById('offerModal').classList.remove('hidden')" class="bg-purple-600 text-white px-5 py-3 rounded-xl text-xs font-bold shadow-lg flex items-center gap-2 hover:scale-105 transition"><i class="fas fa-tag"></i> Create Deal</button>
            </div>
            <div id="offersList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 pb-20"></div>
        </div>

        <div id="view-set" class="hidden slide-up">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border border-slate-100">
                    <h2 class="text-2xl font-black mb-6 text-slate-800">App Configuration</h2>
                    <div class="space-y-4">
                        <input id="setAppName" class="w-full border-2 border-slate-200 p-3 rounded-xl font-bold outline-none focus:border-blue-500 transition" placeholder="App Name">
                        <input id="setAppLogo" class="w-full border-2 border-slate-200 p-3 rounded-xl font-bold outline-none focus:border-blue-500 transition" placeholder="Logo URL">
                        <input id="setUpi" class="w-full border-2 border-blue-200 p-3 rounded-xl font-bold outline-none focus:border-blue-500 transition" placeholder="UPI ID">
                        <div class="grid grid-cols-2 gap-4">
                            <input id="setBase" type="number" class="w-full border-2 border-slate-200 p-3 rounded-xl font-bold outline-none" placeholder="Fee">
                            <input id="setSurge" type="number" step="0.1" class="w-full border-2 border-slate-200 p-3 rounded-xl font-bold outline-none" placeholder="Surge">
                        </div>
                        <label class="flex items-center gap-3 cursor-pointer">
                            <input type="checkbox" id="setAutoAssign" class="w-5 h-5 accent-orange-600 rounded">
                            <span class="font-bold text-sm text-slate-700">Auto-Assign Riders</span>
                        </label>
                        <button id="saveSettingsBtn" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold shadow-lg hover:scale-[1.02]">SAVE SETTINGS</button>
                    </div>
                </div>
                
                <div class="bg-white p-8 rounded-[2.5rem] shadow-xl border border-red-100 h-fit">
                    <h2 class="text-2xl font-black mb-6 text-red-600">Security</h2>
                    <div class="space-y-4">
                        <input id="oldPin" type="password" placeholder="Old PIN" class="w-full border-2 border-slate-200 p-3 rounded-xl font-bold">
                        <input id="newPin" type="password" placeholder="New PIN" class="w-full border-2 border-slate-200 p-3 rounded-xl font-bold">
                        <button id="changePinBtn" class="w-full bg-red-600 text-white py-3 rounded-xl font-bold shadow-lg">CHANGE PIN</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="mobile-nav fixed bottom-0 w-full bg-white border-t p-2 justify-around z-40 hidden pb-6">
        <button onclick="view('dash')" class="text-orange-600 p-2"><i class="fas fa-chart-pie text-xl"></i></button>
        <button onclick="view('req')" class="text-slate-400 p-2 relative"><i class="fas fa-user-check text-xl"></i><span id="mobReqBadge" class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full hidden"></span></button>
        <button onclick="view('shops')" class="text-slate-400 p-2"><i class="fas fa-store text-xl"></i></button>
        <button onclick="view('riders')" class="text-slate-400 p-2"><i class="fas fa-motorcycle text-xl"></i></button>
        <button onclick="view('ord')" class="text-slate-400 p-2"><i class="fas fa-shopping-bag text-xl"></i></button>
    </div>

    <div id="addShopModal" class="fixed inset-0 bg-slate-900/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 slide-up shadow-2xl">
            <h3 class="font-black text-xl mb-4">Create New Shop</h3>
            <div class="space-y-3">
                <input id="nsName" placeholder="Shop Name" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <input id="nsPhone" placeholder="Owner Phone" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <input id="nsPass" placeholder="Password" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <input id="nsLoc" placeholder="Location (Lat,Lng)" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <button onclick="createShop()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold mt-2">CREATE SHOP</button>
                <button onclick="document.getElementById('addShopModal').classList.add('hidden')" class="w-full text-center text-xs font-bold text-slate-400 py-2">Cancel</button>
            </div>
        </div>
    </div>

    <div id="editShopModal" class="fixed inset-0 bg-slate-900/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 slide-up shadow-2xl">
            <h3 class="font-black text-xl mb-4">Edit Shop</h3>
            <input type="hidden" id="editShopId">
            <div class="space-y-3">
                <div><label class="text-xs font-bold text-slate-400 uppercase">Shop Name</label><input id="esName" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none"></div>
                <div><label class="text-xs font-bold text-slate-400 uppercase">Owner Phone</label><input id="esPhone" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none"></div>
                <div><label class="text-xs font-bold text-red-400 uppercase">Change Password</label><input id="esPass" class="w-full border-2 border-red-50 p-3 rounded-xl font-bold outline-none text-red-500" placeholder="New Password (Optional)"></div>
                <button id="updateShopBtn" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold mt-2">UPDATE SHOP</button>
                <button onclick="document.getElementById('editShopModal').classList.add('hidden')" class="w-full text-center text-xs font-bold text-slate-400 py-2">Cancel</button>
            </div>
        </div>
    </div>

    <div id="addRiderModal" class="fixed inset-0 bg-slate-900/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 slide-up shadow-2xl">
            <h3 class="font-black text-xl mb-4">Add Rider</h3>
            <div class="space-y-3">
                <input id="nrName" placeholder="Name" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <input id="nrPhone" placeholder="Phone" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <input id="nrPass" placeholder="Password" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <button onclick="createRider()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold mt-2">ADD RIDER</button>
                <button onclick="document.getElementById('addRiderModal').classList.add('hidden')" class="w-full text-center text-xs font-bold text-slate-400 py-2">Cancel</button>
            </div>
        </div>
    </div>

    <div id="editRiderModal" class="fixed inset-0 bg-slate-900/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-6 slide-up shadow-2xl">
            <h3 class="font-black text-xl mb-4">Edit Rider</h3>
            <input type="hidden" id="editRiderId">
            <div class="space-y-3">
                <input id="erName" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none" placeholder="Name">
                <input id="erPhone" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none" placeholder="Phone">
                <div><label class="text-xs font-bold text-red-400 uppercase">Change Password</label><input id="erPass" class="w-full border-2 border-red-50 p-3 rounded-xl font-bold outline-none text-red-500" placeholder="New Password (Optional)"></div>
                <button id="updateRiderBtn" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold mt-2">UPDATE RIDER</button>
                <button onclick="document.getElementById('editRiderModal').classList.add('hidden')" class="w-full text-center text-xs font-bold text-slate-400 py-2">Cancel</button>
            </div>
        </div>
    </div>

    <div id="offerModal" class="fixed inset-0 bg-slate-900/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-[2rem] p-6 slide-up shadow-2xl">
            <h3 class="font-black text-xl mb-4">Create New Deal</h3>
            <div class="space-y-3">
                <input id="offTitle" placeholder="Offer Title (e.g. Burger Combo)" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none focus:border-purple-500">
                <input id="offDesc" placeholder="Description" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none focus:border-purple-500">
                <div class="grid grid-cols-2 gap-3">
                    <input id="offRate" type="number" placeholder="Original Rate (₹)" class="border-2 border-slate-100 p-3 rounded-xl font-bold outline-none focus:border-purple-500">
                    <input id="offPrice" type="number" placeholder="Offer Price (₹)" class="border-2 border-slate-100 p-3 rounded-xl font-bold outline-none focus:border-purple-500">
                </div>
                <input id="offCode" placeholder="Coupon Code (Optional)" class="w-full border-2 border-slate-100 p-3 rounded-xl font-bold outline-none focus:border-purple-500">
                <div class="border-2 border-dashed border-slate-200 p-4 rounded-xl text-center relative">
                    <input type="file" id="offImgFile" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    <span class="text-xs font-bold text-slate-400"><i class="fas fa-image text-lg mb-1 block"></i> Upload Banner Image</span>
                </div>
                <button onclick="addOffer()" class="w-full bg-purple-600 text-white py-3.5 rounded-xl font-bold mt-2 shadow-lg">PUBLISH DEAL</button>
                <button onclick="document.getElementById('offerModal').classList.add('hidden')" class="w-full text-center text-xs font-bold text-slate-400 py-2">Cancel</button>
            </div>
        </div>
    </div>

    <div id="prodModal" class="fixed inset-0 bg-slate-900/80 z-[60] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md rounded-[2rem] p-6 slide-up shadow-2xl">
            <h3 class="font-black text-xl mb-4" id="prodModalTitle">Add Item</h3>
            <input type="hidden" id="editProdId">
            <input type="hidden" id="prodMode">
            <div class="grid grid-cols-2 gap-3 mb-3">
                <input id="pName" placeholder="Name" class="col-span-2 border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <input id="pPrice" placeholder="Price" class="border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <input id="pQty" placeholder="Stock" class="border-2 border-slate-100 p-3 rounded-xl font-bold outline-none">
                <select id="pCat" class="border-2 border-slate-100 p-3 rounded-xl font-bold outline-none"><option>Food</option><option>Sweets</option><option>Tech</option><option>Fashion</option></select>
                <select id="pShop" class="col-span-2 border-2 border-slate-100 p-3 rounded-xl font-bold outline-none"></select>
                <input type="file" id="pImgFile" class="col-span-2 border-2 border-dashed border-slate-200 p-3 rounded-xl font-bold text-xs">
            </div>
            <button id="saveProdBtn" class="w-full bg-slate-900 text-white py-3 rounded-xl font-bold">SAVE ITEM</button>
            <button onclick="document.getElementById('prodModal').classList.add('hidden')" class="w-full text-center text-xs font-bold text-slate-400 py-2">Cancel</button>
        </div>
    </div>

    <div id="riderDetailModal" class="fixed inset-0 bg-slate-900/95 z-[80] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-2xl rounded-[2.5rem] p-8 shadow-2xl slide-up h-[85vh] flex flex-col">
            <div class="flex justify-between items-start mb-6">
                <div><h2 class="text-3xl font-black text-slate-800" id="rdName">Rider Name</h2><p class="text-sm font-bold text-slate-500" id="rdPhone">Phone</p></div>
                <button onclick="document.getElementById('riderDetailModal').classList.add('hidden')" class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center text-slate-400 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            <div class="grid grid-cols-3 gap-4 mb-6 flex-shrink-0">
                <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 text-center"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Total Deliveries</p><h3 class="text-2xl font-black text-blue-600" id="rdDelCount">0</h3></div>
                <div class="bg-green-50 p-4 rounded-2xl border border-green-100 text-center"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Total Earnings</p><h3 class="text-2xl font-black text-green-600">₹<span id="rdTotalEarn">0</span></h3></div>
                <div class="bg-red-50 p-4 rounded-2xl border border-red-100 text-center"><p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Cash In Hand (COD)</p><h3 class="text-2xl font-black text-red-600">₹<span id="rdCashHand">0</span></h3></div>
            </div>
            <button id="settleRiderBtn" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-bold shadow-lg mb-6 hover:scale-[1.02] transition flex items-center justify-center gap-2"><i class="fas fa-hand-holding-usd"></i> COLLECT CASH & SETTLE</button>
            <div class="flex justify-between items-center mb-4"><h3 class="font-black text-slate-800">Order History</h3><input type="date" id="rdDateFilter" class="bg-slate-50 border p-2 rounded-xl text-xs font-bold outline-none"></div>
            <div class="bg-slate-50 rounded-2xl border border-slate-100 flex-1 overflow-y-auto p-2">
                <table class="w-full text-left"><thead class="text-[10px] text-slate-400 uppercase font-black border-b"><tr><th class="p-3">Date</th><th class="p-3">Order ID</th><th class="p-3">Amount</th><th class="p-3">Fee</th></tr></thead><tbody id="rdHistoryTable" class="text-xs font-bold text-slate-600"></tbody></table>
            </div>
        </div>
    </div>

    <div id="ordDetailModal" class="fixed inset-0 bg-slate-900/90 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-lg rounded-[2.5rem] p-8 shadow-2xl slide-up">
            <h2 class="text-2xl font-black mb-4">Order Details</h2>
            <div id="odContent" class="space-y-4 mb-6 text-sm text-slate-700"></div>
            <div class="flex gap-2">
                <button onclick="document.getElementById('ordDetailModal').classList.add('hidden')" class="bg-slate-100 text-slate-500 py-3 rounded-xl font-bold flex-1">Close</button>
                <button id="odCancelBtn" class="bg-red-500 text-white py-3 rounded-xl font-bold flex-1 hover:bg-red-600">Cancel Order</button>
            </div>
        </div>
    </div>

    <div id="editOrdModal" class="fixed inset-0 bg-slate-900/90 z-[70] hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-sm rounded-[2rem] p-8 shadow-2xl slide-up">
            <h2 class="text-2xl font-black mb-4">Edit Order</h2>
            <input type="hidden" id="eoId">
            <div class="space-y-4">
                <select id="eoStatus" class="w-full border-2 border-slate-200 p-3 rounded-xl font-bold"><option>Pending</option><option>Preparing</option><option>Ready for Pickup</option><option>Out for Delivery</option><option>Delivered</option><option>Cancelled</option></select>
                <select id="eoRider" class="w-full border-2 border-slate-200 p-3 rounded-xl font-bold"><option value="">Assign Rider</option></select>
                <button onclick="saveOrdEdit()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700">Update Order</button>
                <button onclick="document.getElementById('editOrdModal').classList.add('hidden')" class="w-full text-center text-xs font-bold text-slate-400 py-2">Cancel</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, onSnapshot, deleteDoc, setDoc, getDoc, query, where } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyCwyzE9sdZZUU3dHUix23zEzFkGr2nNRyw", authDomain: "foodhub-8ae15.firebaseapp.com", projectId: "foodhub-8ae15", storageBucket: "foodhub-8ae15.firebasestorage.app", messagingSenderId: "274265160043", appId: "1:274265160043:web:81238fd424681e7f70342e" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let orders=[], riders=[], shops=[], products=[], reqs=[], riderReqs=[], offers=[];

        // --- PWA ---
        let deferredPrompt; window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; document.getElementById('installBanner').classList.remove('hidden'); }); document.getElementById('installBtn').onclick = async () => { if(deferredPrompt){ deferredPrompt.prompt(); const {outcome} = await deferredPrompt.userChoice; if(outcome==='accepted'){ deferredPrompt=null; document.getElementById('installBanner').classList.add('hidden'); } } };

        // --- AUTH ---
        window.auth = async () => {
            let pin = document.getElementById('pin').value;
            let docSnap = await getDoc(doc(db, "settings", "security"));
            let realPin = (docSnap.exists() && docSnap.data().adminPin) ? docSnap.data().adminPin : "1234";
            if(pin === realPin) {
                document.getElementById('login').classList.add('hidden');
                document.getElementById('sidebarPanel').classList.remove('hidden');
                document.getElementById('mainPanel').classList.remove('hidden');
                document.querySelector('.mobile-nav').classList.remove('hidden');
                init();
            } else alert("Wrong PIN");
        };

        document.getElementById('changePinBtn').onclick = async () => {
            let old = document.getElementById('oldPin').value, newP = document.getElementById('newPin').value;
            let docSnap = await getDoc(doc(db, "settings", "security"));
            let current = (docSnap.exists() && docSnap.data().adminPin) ? docSnap.data().adminPin : "1234";
            if(old === current) { await setDoc(doc(db, "settings", "security"), { adminPin: newP }, {merge:true}); alert("PIN Changed!"); }
            else alert("Wrong Old PIN");
        };

        // --- INIT DATA ---
        function init() {
            onSnapshot(collection(db, "orders"), s => { orders=s.docs.map(d=>({id:d.id,...d.data()})); document.getElementById('dashOrd').innerText = orders.length; renderOrd(); });
            onSnapshot(collection(db, "riders"), s => { 
                riders=s.docs.map(d=>({id:d.id,...d.data()})); 
                document.getElementById('dashRiders').innerText = riders.length; 
                renderRiders();
                document.getElementById('eoRider').innerHTML = `<option value="">Assign Rider</option>` + riders.map(r=>`<option value="${r.phone}">${r.name} (${r.isOnline?'On':'Off'})</option>`).join('');
            });
            onSnapshot(collection(db, "shops"), s => { 
                shops=s.docs.map(d=>({id:d.id,...d.data()})); 
                document.getElementById('dashShops').innerText = shops.length; 
                renderShops(); 
                document.getElementById('pShop').innerHTML = `<option value="">Select Shop</option>` + shops.map(s=>`<option value="${s.id}">${s.shopName}</option>`).join(''); 
            });
            onSnapshot(collection(db, "products"), s => { products=s.docs.map(d=>({id:d.id,...d.data()})); renderProd(); });
            onSnapshot(collection(db, "offers"), s => { offers=s.docs.map(d=>({id:d.id,...d.data()})); renderOffers(); });
            onSnapshot(collection(db, "shop_requests"), s => { reqs = s.docs.map(d=>({id:d.id,...d.data()})); document.getElementById('shopReqCount').innerText = reqs.length; renderReqs(); });
            onSnapshot(collection(db, "rider_requests"), s => { riderReqs = s.docs.map(d=>({id:d.id,...d.data()})); document.getElementById('riderReqCount').innerText = riderReqs.length; renderReqs(); });
            onSnapshot(doc(db, "settings", "global"), s => { if(s.exists()){ let d = s.data(); document.getElementById('setAppName').value = d.appName || ''; document.getElementById('setAppLogo').value = d.appLogo || ''; document.getElementById('setUpi').value = d.upi || ''; document.getElementById('setBase').value = d.fee || ''; document.getElementById('setSurge').value = d.surge || ''; document.getElementById('setAutoAssign').checked = d.autoAssign || false; } });
        }

        // --- RIDER POPUP ---
        window.openRiderDetail = (rid) => {
            let r = riders.find(x => x.id === rid); if(!r) return;
            document.getElementById('rdName').innerText = r.name; document.getElementById('rdPhone').innerText = r.phone; document.getElementById('riderDetailModal').classList.remove('hidden');
            updateRiderStats(r.phone);
        };
        function updateRiderStats(phone) {
            let rOrders = orders.filter(o => o.riderPhone === phone && o.status === 'Delivered');
            let totalEarned = rOrders.reduce((acc, o) => acc + (parseInt(o.deliveryFee) || 0), 0);
            let cashHand = orders.filter(o => o.riderPhone === phone && o.status === 'Delivered' && (o.paymentMethod === 'Cash' || o.paymentMethod === 'COD') && !o.adminCollected).reduce((acc, o) => acc + (parseInt(o.total) || 0), 0);
            document.getElementById('rdDelCount').innerText = rOrders.length; document.getElementById('rdTotalEarn').innerText = totalEarned; document.getElementById('rdCashHand').innerText = cashHand;
            document.getElementById('settleRiderBtn').onclick = () => settleCash(phone, cashHand);
            renderRiderHistory(rOrders);
            document.getElementById('rdDateFilter').onchange = (e) => { let dateStr = new Date(e.target.value).toLocaleDateString(); renderRiderHistory(e.target.value ? rOrders.filter(o => o.date && o.date.includes(dateStr)) : rOrders); }
        }
        function renderRiderHistory(list) { document.getElementById('rdHistoryTable').innerHTML = list.map(o => `<tr class="border-b border-slate-100 hover:bg-slate-50"><td class="p-3 text-slate-400">${o.date || '-'}</td><td class="p-3 text-slate-800">#${o.id.substr(0,5)}</td><td class="p-3 font-black">₹${o.total}</td><td class="p-3 text-green-600">+₹${o.deliveryFee || 0}</td></tr>`).join('') || '<tr><td colspan="4" class="p-4 text-center text-slate-400">No history found</td></tr>'; }
        async function settleCash(phone, amount) { if(amount <= 0) return alert("No cash to settle."); if(!confirm(`Collect ₹${amount}?`)) return; let pendingOrders = orders.filter(o => o.riderPhone === phone && o.status === 'Delivered' && (o.paymentMethod === 'Cash' || o.paymentMethod === 'COD') && !o.adminCollected); for (let o of pendingOrders) { await updateDoc(doc(db, "orders", o.id), { adminCollected: true }); } alert("Settled!"); updateRiderStats(phone); }

        // --- OFFERS LOGIC ---
        window.addOffer = () => {
            const file = document.getElementById('offImgFile').files[0];
            if(!file) return alert("Please select an image");
            const reader = new FileReader(); reader.readAsDataURL(file);
            reader.onload = async () => {
                await addDoc(collection(db, "offers"), {
                    title: document.getElementById('offTitle').value,
                    desc: document.getElementById('offDesc').value,
                    rate: document.getElementById('offRate').value,
                    price: document.getElementById('offPrice').value,
                    code: document.getElementById('offCode').value,
                    img: reader.result
                });
                document.getElementById('offerModal').classList.add('hidden');
                alert("Deal Published!");
            }
        };
        window.delOffer = async (id) => { if(confirm("Delete this Deal?")) await deleteDoc(doc(db,"offers",id)); };
        function renderOffers() {
            document.getElementById('offersList').innerHTML = offers.map(o => `
            <div class="bg-white p-4 rounded-[2rem] shadow-lg relative group overflow-hidden border border-slate-100">
                <button onclick="delOffer('${o.id}')" class="absolute top-3 right-3 bg-white text-red-500 w-8 h-8 rounded-full flex items-center justify-center shadow-md z-10 hover:bg-red-50"><i class="fas fa-trash"></i></button>
                <div class="h-32 bg-slate-50 rounded-2xl mb-3 overflow-hidden"><img src="${o.img}" class="w-full h-full object-cover"></div>
                <h3 class="font-black text-lg leading-tight">${o.title}</h3>
                <p class="text-xs text-slate-500 mb-2">${o.desc}</p>
                <div class="flex justify-between items-center bg-slate-50 p-2 rounded-xl">
                    <div class="text-xs"><span class="line-through text-slate-400">₹${o.rate}</span> <span class="font-black text-slate-900 text-sm">₹${o.price}</span></div>
                    <code class="text-xs font-bold text-purple-600 bg-purple-50 px-2 py-1 rounded">${o.code}</code>
                </div>
            </div>`).join('');
        }

        // --- ORDER LOGIC ---
        function renderOrd() {
            let s = document.getElementById('ordSearch').value.toLowerCase();
            document.getElementById('ordList').innerHTML = orders.filter(o=>o.id.toLowerCase().includes(s)).map(o => `
                <div class="bg-white p-5 rounded-2xl border flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="w-full">
                        <div class="flex justify-between items-center mb-1"><span class="font-black text-lg">#${o.id.substr(0,5)}</span><span class="text-xs bg-slate-100 px-2 py-1 rounded font-bold">${o.status}</span></div>
                        <p class="text-sm font-bold text-slate-600">${o.customer.name}</p>
                        <p class="text-xs text-slate-400">${o.riderName ? 'Rider: '+o.riderName : 'No Rider Assigned'}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="openOrdDetail('${o.id}')" class="bg-slate-100 w-10 h-10 rounded-xl flex items-center justify-center text-slate-500 hover:text-blue-600"><i class="fas fa-eye"></i></button>
                        <button onclick="editOrd('${o.id}')" class="bg-blue-100 w-10 h-10 rounded-xl flex items-center justify-center text-blue-600"><i class="fas fa-pen"></i></button>
                        <button onclick="delOrd('${o.id}')" class="bg-red-100 w-10 h-10 rounded-xl flex items-center justify-center text-red-600"><i class="fas fa-trash"></i></button>
                    </div>
                </div>`).join('');
        }
        window.openOrdDetail = (id) => {
            let o = orders.find(x=>x.id===id);
            document.getElementById('odContent').innerHTML = `<p><b>Customer:</b> ${o.customer.name}</p><p><b>Phone:</b> ${o.customer.phone}</p><p><b>Address:</b> ${o.customer.addr}</p><hr class="my-2 border-dashed"><p><b>Items:</b></p>${o.items.map(i=>`<div>${i.qty}x ${i.name}</div>`).join('')}<hr class="my-2 border-dashed"><p class="text-xl font-black text-right">Total: ₹${o.total}</p>`;
            document.getElementById('odCancelBtn').onclick = async () => { if(confirm("Cancel Order?")) { await updateDoc(doc(db,"orders",id), {status:'Cancelled'}); document.getElementById('ordDetailModal').classList.add('hidden'); } };
            document.getElementById('ordDetailModal').classList.remove('hidden');
        };
        window.editOrd = (id) => { document.getElementById('eoId').value = id; document.getElementById('editOrdModal').classList.remove('hidden'); };
        window.saveOrdEdit = async () => {
            let id = document.getElementById('eoId').value, st = document.getElementById('eoStatus').value, rp = document.getElementById('eoRider').value;
            let data = { status: st }; if(rp) { let r = riders.find(x=>x.phone===rp); data.riderPhone=rp; data.riderName=r.name; }
            await updateDoc(doc(db, "orders", id), data); document.getElementById('editOrdModal').classList.add('hidden');
        };
        window.delOrd = async (id) => { if(confirm("Permanently Delete Order?")) await deleteDoc(doc(db,"orders",id)); };

        // --- RENDERERS ---
        function renderReqs() {
            document.getElementById('shopReqList').innerHTML = reqs.map(r => `<div class="bg-white p-5 rounded-2xl shadow-sm border flex justify-between items-center"><div><h4 class="font-bold">${r.shopName}</h4><p class="text-xs text-slate-500">${r.phone}</p></div><div class="flex gap-2"><button onclick="window.appShop('${r.id}')" class="bg-green-500 text-white px-3 py-1 rounded-lg text-xs font-bold">Approve</button><button onclick="window.delShopReq('${r.id}')" class="bg-red-500 text-white px-3 py-1 rounded-lg text-xs font-bold">Reject</button></div></div>`).join('') || '<p class="text-xs text-slate-400">No pending shop requests</p>';
            document.getElementById('riderReqList').innerHTML = riderReqs.map(r => `<div class="bg-white p-5 rounded-2xl shadow-sm border flex justify-between items-center"><div><h4 class="font-bold">${r.name}</h4><p class="text-xs text-slate-500">${r.vehicle} • ${r.phone}</p></div><div class="flex gap-2"><button onclick="window.appRider('${r.id}')" class="bg-green-500 text-white px-3 py-1 rounded-lg text-xs font-bold">Approve</button><button onclick="window.delRiderReq('${r.id}')" class="bg-red-500 text-white px-3 py-1 rounded-lg text-xs font-bold">Reject</button></div></div>`).join('') || '<p class="text-xs text-slate-400">No pending rider requests</p>';
            let total = reqs.length + riderReqs.length; document.getElementById('reqBadge').innerText = total; document.getElementById('reqBadge').classList.toggle('hidden', total === 0);
        }
        function renderShops() { let s = document.getElementById('shopSearch')?.value.toLowerCase() || ''; document.getElementById('shopList').innerHTML = shops.filter(x=>x.shopName.toLowerCase().includes(s)).map(s => `<div class="bg-white p-5 rounded-2xl shadow-sm border relative"><h4 class="font-bold text-lg">${s.shopName}</h4><p class="text-xs text-slate-500">${s.phone}</p><div class="flex gap-2 mt-3"><button onclick="window.editShop('${s.id}')" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-lg text-xs font-bold">Edit</button><button onclick="window.delShop('${s.id}')" class="bg-red-100 text-red-600 px-3 py-1 rounded-lg text-xs font-bold">Delete</button></div></div>`).join(''); }
        function renderRiders() { let s = document.getElementById('riderSearch')?.value.toLowerCase() || ''; document.getElementById('ridList').innerHTML = riders.filter(x => x.name.toLowerCase().includes(s) || x.phone.includes(s)).map(r => `<div class="bg-white p-5 rounded-2xl shadow-sm border relative"><h4 class="font-bold">${r.name}</h4><p class="text-xs text-slate-500">${r.phone}</p><p class="text-xs font-bold ${r.isOnline?'text-green-500':'text-slate-400'}">● ${r.isOnline?'Online':'Offline'}</p><div class="flex gap-2 mt-3"><button onclick="window.openRiderDetail('${r.id}')" class="bg-slate-900 text-white px-4 py-1.5 rounded-lg text-xs font-bold">View / Manage</button><button onclick="window.editRider('${r.id}')" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-lg text-xs font-bold">Edit</button><button onclick="window.delRider('${r.id}')" class="text-red-500 text-xs font-bold underline">Remove</button></div></div>`).join(''); }
        function renderProd() { document.getElementById('allProdList').innerHTML = products.map(p => `<div class="bg-white p-3 rounded-2xl border text-center relative group"><button onclick="window.editProd('${p.id}')" class="absolute top-1 left-1 text-blue-400 hover:text-blue-600"><i class="fas fa-pen"></i></button><button onclick="window.delProd('${p.id}')" class="absolute top-1 right-1 text-red-400 hover:text-red-600"><i class="fas fa-times"></i></button><div class="h-20 bg-slate-50 rounded-xl mb-2 overflow-hidden"><img src="${p.img}" class="w-full h-full object-cover"></div><p class="font-bold text-xs truncate">${p.name}</p><p class="text-xs font-black text-orange-500">₹${p.price}</p></div>`).join(''); }

        // --- ACTIONS ---
        window.appShop = async (id) => { let r=reqs.find(x=>x.id==id); await addDoc(collection(db,"shops"), {...r, pass:'123456'}); await deleteDoc(doc(db,"shop_requests",id)); };
        window.delShopReq = async (id) => await deleteDoc(doc(db,"shop_requests",id));
        window.appRider = async (id) => { let r=riderReqs.find(x=>x.id==id); await addDoc(collection(db,"riders"), {name:r.name, phone:r.phone, pass:r.pass, vehicle:r.vehicle, isOnline:false}); await deleteDoc(doc(db,"rider_requests",id)); };
        window.delRiderReq = async (id) => await deleteDoc(doc(db,"rider_requests",id));

        window.createShop = async () => {
            let n=document.getElementById('nsName').value, p=document.getElementById('nsPhone').value, pa=document.getElementById('nsPass').value, l=document.getElementById('nsLoc').value;
            if(!n||!p||!pa) return alert("Fill details");
            await addDoc(collection(db,"shops"), {shopName:n, phone:p, pass:pa, location:l});
            document.getElementById('addShopModal').classList.add('hidden');
        };

        window.editShop = (id) => { let s=shops.find(x=>x.id==id); document.getElementById('editShopId').value=id; document.getElementById('esName').value=s.shopName; document.getElementById('esPhone').value=s.phone; document.getElementById('esPass').value=''; document.getElementById('editShopModal').classList.remove('hidden'); };
        document.getElementById('updateShopBtn').onclick = async () => { let id=document.getElementById('editShopId').value; let data={shopName:document.getElementById('esName').value, phone:document.getElementById('esPhone').value}; let p=document.getElementById('esPass').value; if(p) data.pass=p; await updateDoc(doc(db,"shops",id), data); document.getElementById('editShopModal').classList.add('hidden'); };
        window.delShop = async (id) => { if(confirm("Delete Shop?")) await deleteDoc(doc(db,"shops",id)); };
        
        window.createRider = async () => {
            let n=document.getElementById('nrName').value, p=document.getElementById('nrPhone').value, pa=document.getElementById('nrPass').value;
            await addDoc(collection(db,"riders"), {name:n, phone:p, pass:pa, isOnline:false});
            document.getElementById('addRiderModal').classList.add('hidden');
        };
        
        window.editRider = (id) => { let r=riders.find(x=>x.id==id); document.getElementById('editRiderId').value=id; document.getElementById('erName').value=r.name; document.getElementById('erPhone').value=r.phone; document.getElementById('erPass').value=''; document.getElementById('editRiderModal').classList.remove('hidden'); };
        document.getElementById('updateRiderBtn').onclick = async () => { let id=document.getElementById('editRiderId').value; let data={name:document.getElementById('erName').value, phone:document.getElementById('erPhone').value}; let p=document.getElementById('erPass').value; if(p) data.pass=p; await updateDoc(doc(db,"riders",id), data); document.getElementById('editRiderModal').classList.add('hidden'); };
        
        window.delRider = async (id) => { if(confirm("Remove Rider?")) await deleteDoc(doc(db,"riders",id)); };

        window.addOffer = async () => { await addDoc(collection(db,"offers"), {title:document.getElementById('offTitle').value, desc:document.getElementById('offDesc').value, code:document.getElementById('offCode').value, color:document.getElementById('offColor').value, tag:'Deal'}); document.getElementById('offerModal').classList.add('hidden'); };
        window.delOffer = async (id) => await deleteDoc(doc(db,"offers",id));

        // -- Product CRUD --
        window.editProd = (id) => {
            let p = products.find(x=>x.id==id);
            document.getElementById('prodModalTitle').innerText = "Edit Item";
            document.getElementById('prodMode').value = id; // Store ID in hidden input
            document.getElementById('pName').value = p.name;
            document.getElementById('pPrice').value = p.price;
            document.getElementById('pQty').value = p.stock;
            document.getElementById('pCat').value = p.cat;
            document.getElementById('pShop').value = p.shopId;
            document.getElementById('saveProdBtn').innerText = "UPDATE ITEM";
            document.getElementById('prodModal').classList.remove('hidden');
        };

        document.getElementById('saveProdBtn').onclick = async () => {
            let id = document.getElementById('prodMode').value;
            let n = document.getElementById('pName').value, pr = document.getElementById('pPrice').value;
            let f = document.getElementById('pImgFile').files[0];
            
            let data = {
                shopId: document.getElementById('pShop').value,
                name: n, price: pr,
                stock: document.getElementById('pQty').value,
                cat: document.getElementById('pCat').value,
                inStock: true
            };

            if (f) {
                let r = new FileReader(); r.readAsDataURL(f);
                r.onload = async () => {
                    data.img = r.result;
                    if(id === 'add') await addDoc(collection(db,"products"), data);
                    else await updateDoc(doc(db,"products",id), data);
                    document.getElementById('prodModal').classList.add('hidden');
                }
            } else {
                if(id === 'add') return alert("Image Required");
                await updateDoc(doc(db,"products",id), data);
                document.getElementById('prodModal').classList.add('hidden');
            }
        };
        window.delProd = async (id) => { if(confirm("Delete Item?")) await deleteDoc(doc(db,"products",id)); };

        document.getElementById('saveSettingsBtn').onclick = async () => { await setDoc(doc(db,"settings","global"), {appName:document.getElementById('setAppName').value, upi:document.getElementById('setUpi').value, fee:document.getElementById('setBase').value, surge:document.getElementById('setSurge').value, autoAssign:document.getElementById('setAutoAssign').checked}); alert("Saved"); };

        window.view = (v) => { ['dash','req','shops','riders','ord','offers','set','menu'].forEach(x => { document.getElementById('view-'+x).classList.add('hidden'); let btn=document.getElementById('nav-'+x); if(btn) btn.classList.remove('active'); }); document.getElementById('view-'+v).classList.remove('hidden'); let btn=document.getElementById('nav-'+v); if(btn) btn.classList.add('active'); };
    </script>
</body>
</html>