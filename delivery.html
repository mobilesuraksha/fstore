<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F-store Rider</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-white font-sans">

    <div id="login" class="fixed inset-0 bg-gray-900 flex flex-col items-center justify-center z-50">
        <div class="bg-gray-800 p-8 rounded-2xl w-80 text-center border border-gray-700 shadow-2xl">
            <i class="fas fa-shipping-fast text-5xl text-orange-500 mb-4"></i>
            <h2 class="text-xl font-bold mb-4">RIDER LOGIN</h2>
            <input type="password" id="pin" placeholder="PIN: 5555" class="w-full bg-gray-900 border border-gray-600 p-3 rounded-lg text-center font-bold mb-4 text-white">
            <button onclick="login()" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-bold transition">START SHIFT</button>
        </div>
    </div>

    <div id="app" class="hidden p-4">
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-xl font-bold italic">F-store <span class="text-orange-500">Partner</span></h1>
            <div class="flex items-center gap-2">
                <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                <span class="text-xs font-bold text-gray-400">Online</span>
            </div>
        </header>

        <h2 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-4">Active Deliveries</h2>
        <div id="taskList" class="space-y-4"></div>
    </div>

    <script>
        function login(){ 
            if(document.getElementById('pin').value==='5555'){ 
                document.getElementById('login').classList.add('hidden'); 
                document.getElementById('app').classList.remove('hidden'); 
                loadTasks(); 
            } else alert("Wrong PIN"); 
        }

        function loadTasks() {
            let orders = JSON.parse(localStorage.getItem('f_orders')) || [];
            // Filter only "Out for Delivery" tasks
            let tasks = orders.filter(o => o.status === 'Out for Delivery');
            
            const list = document.getElementById('taskList');
            list.innerHTML = "";

            if(tasks.length === 0) list.innerHTML = "<div class='text-center mt-20 text-gray-600'><i class='fas fa-check-circle text-4xl mb-2'></i><p>All caught up!</p></div>";

            tasks.forEach(o => {
                let originalIndex = orders.findIndex(x => x.id === o.id);
                // LOGIC: If Lat/Lng exists, use coordinates. Else use address text.
                let mapLink = (o.customer.lat && o.customer.lng) 
                    ? `https://www.google.com/maps/search/?api=1&query=${o.customer.lat},${o.customer.lng}`
                    : `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(o.customer.addr)}`;

                list.innerHTML += `
                    <div class="bg-gray-800 p-5 rounded-2xl border border-gray-700 shadow-lg">
                        <div class="flex justify-between mb-3 border-b border-gray-700 pb-3">
                            <span class="font-bold text-orange-500">#${o.id}</span>
                            <span class="text-xs bg-gray-700 px-2 py-1 rounded font-bold ${o.payment.includes('Paid') ? 'text-green-400' : 'text-yellow-400'}">${o.payment.includes('Paid') ? 'PREPAID' : 'COLLECT CASH'}</span>
                        </div>
                        <div class="mb-4">
                            <h3 class="text-lg font-bold text-white">${o.customer.name}</h3>
                            <p class="text-gray-400 text-sm mt-1 leading-snug">${o.customer.addr}</p>
                            <div class="flex gap-4 mt-3">
                                <a href="tel:${o.customer.phone}" class="text-blue-400 text-sm font-bold flex items-center gap-1 hover:text-blue-300"><i class="fas fa-phone"></i> Call</a>
                                <span class="text-gray-500 text-sm">|</span>
                                <span class="text-orange-400 text-sm font-bold">â‚¹${o.total}</span>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <a href="${mapLink}" target="_blank" class="flex-1 bg-gray-700 text-white py-3 rounded-xl text-center font-bold text-sm hover:bg-gray-600 transition flex items-center justify-center gap-2">
                                <i class="fas fa-map-marker-alt text-red-400"></i> NAVIGATE
                            </a>
                            <button onclick="finish(${originalIndex})" class="flex-1 bg-green-600 text-white py-3 rounded-xl text-center font-bold text-sm hover:bg-green-500 transition shadow-lg shadow-green-900/50">
                                DELIVERED <i class="fas fa-check ml-1"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        function finish(idx) {
            if(confirm("Complete Delivery?")) {
                let orders = JSON.parse(localStorage.getItem('f_orders'));
                orders[idx].status = 'Delivered';
                localStorage.setItem('f_orders', JSON.stringify(orders));
                loadTasks();
            }
        }

        setInterval(loadTasks, 5000);
    </script>
</body>
</html>